---
title: 每天学点C++ (3)
date: 2024-03-19 14:16:22
categories: [Learning, 每天学点C++]
tags: [C++]
---

## 设计模式 (2)

### Decorator 装饰模式

#### 动机

在某些情况下我们可能会“过度地使用继承来扩展对象的功能”，由于继承为类型引入的静态特质，使得这种扩展方式缺乏灵活性；并且随着子类的增多（扩展功能的增多），各种子类的组合（扩展功能的组合）会导致更多子类的膨胀。

如何使“对象功能的扩展”能够根据需要来动态地实现？同时避免“扩展功能的增多”带来的子类膨胀问题？从而使得任何“功能扩展变化”所导致的影响将为最低？

#### 模式定义

动态（组合）地给一个对象增加一些额外的职责。就增加功能而言，Decorator 模式比生成子类（继承）更为灵活（消除重复代码 & 减少子类个数）。

#### 结构

![Decorator 装饰模式 结构](/images/每天学点C++/8.png)

![Decorator 装饰模式 类图-1](/images/每天学点C++/10.png)

![Decorator 装饰模式 类图-2](/images/每天学点C++/9.png)

#### 要点总结

- 通过采用组合而非继承的手法， Decorator 模式实现了在运行时 动态扩展对象功能的能力，而且可以根据需要扩展多个功能。避免 了使用继承带来的“灵活性差”和“多子类衍生问题”。
- Decorator 类在接口上表现为 is-a Component 的继承关系，即 Decorator 类继承了 Component 类所具有的接口。但在实现上又 表现为 has-a Component 的组合关系，即 Decorator 类又使用了 另外一个 Component 类。
- Decorator 模式的目的并非解决“多子类衍生的多继承”问题， Decorator 模式应用的要点在于解决“主体类在多个方向上的扩展 功能”——是为“装饰”的含义。

### Bridge 桥模式

#### 动机

由于某些类型的固有的实现逻辑，使得它们具有两个变化的维度，乃至多个纬度的变化。
如何应对这种“多维度的变化”？如何利用面向对象技术来使得类型可以轻松地沿着两个乃至多个方向变化，而不引入额外的复杂度

#### 模式定义

将抽象部分(业务功能)与实现部分(平台实现)分离，使它们都可以独立地变化。

#### 结构

![Bridge 桥模式 结构](/images/每天学点C++/11.png)

#### 要点总结

- Bridge 模式使用“对象间的组合关系”解耦了抽象和实现之间固 有的绑定关系，使得抽象和实现可以沿着各自的维度来变化。所谓抽象和实现沿着各自纬度的变化，即“子类化”它们。
- Bridge 模式有时候类似于多继承方案，但是多继承方案往往违背 单一职责原则（即一个类只有一个变化的原因），复用性比较差。Bridge 模式是比多继承方案更好的解决方法。
- Bridge 模式的应用一般在“两个非常强的变化维度”，有时一个 类也有多于两个的变化维度，这时可以使用 Bridge 的扩展模式

### Factory Method 工厂方法

#### 动机

在软件系统中，经常面临着创建对象的工作；由于需求的变化，需要创建的对象的具体类型经常变化。
如何应对这种变化？如何绕过常规的对象创建方法(new)，提供一种“封装机制”来避免客户程序和这种“具体对象创建工作”的紧耦合。

#### 模式定义

定义一个用于创建对象的接口，让子类决定实例化哪一个类。
Factory Method 使得一个类的实例化延迟（目的：解耦，手段：虚函数）到子类

#### 结构

![Factory Method 工厂方法 结构](/images/每天学点C++/12.png)

#### 要点总结

- Factory Method 模式用于隔离类对象的使用者和具体类型之间的 耦合关系。面对一个经常变化的具体类型，紧耦合关系(new)会导 致软件的脆弱。
- Factory Method 模式通过面向对象的手法，将所要创建的具体对 象工作延迟到子类，从而实现一种扩展（而非更改）的策略，较好地解决了这种紧耦合关系。
- Factory Method 模式解决“单个对象”的需求变化。缺点在于要求创建方法/参数相同。

### Abstract Factory 抽象工厂

#### 动机

在软件系统中，经常面临着“一系列相互依赖的对象”的创建工作；同时，由于需求的变化，往往存在更多系列对象的创建工作。
如何应对这种变化？如何绕过常规的对象创建方法(new)，提供一种“封装机制”来避免客户程序和这种“多系列具体对象创建工作”的紧耦合？

#### 模式定义

提供一个接口，让该接口负责创建一系列“相关或者相互依赖的对象”，无需指定它们具体的类。

#### 结构

![Abstract Factory 抽象工厂 结构](/images/每天学点C++/13.png)

#### 要点总结

- 如果没有应对“多系列对象构建”的需求变化，则没有必要使用 Abstract Factory 模式，这时候使用简单的工厂完全可以。
- “系列对象”指的是在某一特定系列下的对象之间有相互依赖、或作用的关系。不同系列的对象之间不能相互依赖。
- Abstract Factory 模式主要在于应对“新系列”的需求变动。其缺点在于难以应对“新对象”的需求变动。
